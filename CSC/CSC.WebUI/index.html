<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>Elm + Websockets</title>
  <script type="text/javascript" src="elm.js"></script>
</head>

<body>
    <div id="myapp"></div>
</body>

<script type="text/javascript">

// Start the Elm application.
var app = Elm.Main.init({
    node: document.getElementById('myapp')
});

var wsUri = "ws://localhost:8080/websocket";

  function init()
  {
    testWebSocket();
  }

  function testWebSocket()
  {
    websocket = new WebSocket(wsUri);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }

  function onOpen(evt)
  {
    log("CONNECTED");
  }

  function onClose(evt)
  {
    log("DISCONNECTED");
  }

  function onMessage(evt)
  {
    log(evt.data);
    app.ports.messageReceiver.send(event.data);
  }

  function onError(evt)
  {
    log('<span style="color: red;">ERROR:</span> ' + evt.data);
  }

  window.addEventListener("load", init, false);

// When a command goes to the `sendMessage` port, we pass the message
// along to the WebSocket.
app.ports.sendMessage.subscribe(function(message) {
  websocket.send(message);
});


</script>

</html>